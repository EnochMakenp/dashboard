{"version":3,"file":"static/webpack/static/development/pages/index.js.9c0f3659143a0f062126.hot-update.js","sources":["webpack:///./lib/api.js"],"sourcesContent":["import 'isomorphic-unfetch' // eslint-disable-line import/no-unassigned-import\nimport {groupBy, sortBy, defaults, pick} from 'lodash'\n\nconst SOURCE_PRIORITIES = {\n  'ministere-sante': 1,\n  'sante-publique-france': 2,\n  'agences-regionales-sante': 3,\n  prefectures: 4,\n  'lperez-historical-data': 5\n}\n\nexport async function fetchJson(url) {\n  const response = await fetch(url)\n  if (response && response.ok) {\n    return response.json()\n  }\n}\n\nfunction consolidate(records) {\n  const territoriesGroups = groupBy(records, r => `${r.date}-${r.code}`)\n\n  return Object.keys(territoriesGroups).map(id => {\n    return pick(sortBy(territoriesGroups[id], r => SOURCE_PRIORITIES[r.sourceType])\n      .reduce((acc, row) => {\n        defaults(acc, row)\n        return acc\n      }, {}), ['casConfirmes', 'deces', 'reanimation', 'hospitalises', 'gueris', 'date', 'code', 'nom'])\n  })\n}\n\nconst GOUV_START_DATE = '2020-03-02'\n\nfunction filterRecords(records, isGouv) {\n  if (!isGouv) {\n    return records.filter(r => r.date >= GOUV_START_DATE)\n  }\n\n  return records\n    .filter(r => ['ministere-sante', 'sante-publique-france'].includes(r.sourceType))\n    .filter(r => r.date >= GOUV_START_DATE)\n}\n\nexport const getData = async isGouv => {\n  const records = await fetchJson('https://raw.githubusercontent.com/opencovid19-fr/data/master/dist/chiffres-cles.json')\n\n  return consolidate(filterRecords(records, isGouv))\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;A","sourceRoot":""}